/*
  filename: integralui.contextmenu.js
  version : 1.2.0
  Copyright Â© 2016-2017 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(d,a){function b(){this.constructor=d}for(var c in a)a.hasOwnProperty(c)&&(d[c]=a[c]);d.prototype=null===a?Object.create(a):(b.prototype=a.prototype,new b)},__decorate=this&&this.__decorate||function(d,a,b,c){var h=arguments.length,f=3>h?a:null===c?c=Object.getOwnPropertyDescriptor(a,b):c,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)f=Reflect.decorate(d,a,b,c);else for(var e=d.length-1;0<=e;e--)if(g=d[e])f=(3>h?g(f):3<h?g(a,b,f):
g(a,b))||f;return 3<h&&f&&Object.defineProperty(a,b,f),f},__metadata=this&&this.__metadata||function(d,a){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(d,a)},core_1=require("@angular/core"),integralui_core_1=require("../components/integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_menuitem_1=require("../components/integralui.menuitem"),
IntegralUIContextMenuComponent=function(d){function a(b,c,a,f,g){var e=d.call(this,a)||this;e.dataService=b;e.elemRef=c;e.commonService=a;e.cmpResolver=f;e.baseService=g;e.blockDisplay="none";e.blockElemWidth="0";e.blockElemHeight="0";e.blockOverflow="hidden";e.blockOpacity=0;e.trialRef=null;e.position={x:"0",y:"0"};e.itemClick=new core_1.EventEmitter;e.menuOpened=new core_1.EventEmitter;e.menuClosed=new core_1.EventEmitter;e.itemList=[];return e}__extends(a,d);a.prototype.ngOnInit=function(){this.baseService.setComponent(this);
this.dataService.init(this.items);this.generalClassName="iui-contextmenu";this.initStyle()};a.prototype.ngAfterViewInit=function(){var b=this,c=setTimeout(function(){var a=b.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);a&&b.contentRef&&(b.trialRef=b.contentRef.createComponent(a));clearTimeout(c)},100)};a.prototype.ngAfterContentInit=function(){var b=this,a=setTimeout(function(){b.elemRef.nativeElement.firstElementChild.focus();clearTimeout(a)},1)};a.prototype.ngOnDestroy=
function(){this.trialRef&&this.trialRef.destroy()};a.prototype.onBlur=function(b){this.menuClosed.emit({event:b})};a.prototype.onRightClick=function(b){b.preventDefault()};a.prototype.getItemFromComponent=function(b){return b&&b.data?b.data:this.items&&(this.itemList=this.contentList.toArray(),b=this.itemList.indexOf(b),0<=b&&b<this.items.length)?this.items[b]:null};a.prototype.invokeMethod=function(b,a){switch(b){case "ITEM_CLICK":this.itemClick.emit({event:a.event,item:this.getItemFromComponent(a.cmp)})}};
a.prototype.open=function(b){var a=this;if(a.items){var d=17*a.items.length,f=0,g=0;a.blockDisplay="block";var e=setInterval(function(){f<d?(g=0==g?1:g+5,f+=g,a.blockElemHeight=f+"px",a.blockOpacity=f/d):(a.blockElemHeight="auto",a.blockOverflow="visible",a.blockOpacity=1,a.menuOpened.emit({event:b}),clearInterval(e))},15)}};return a}(integralui_core_1.IntegralUIBaseComponent);
__decorate([core_1.ViewChild("content",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],IntegralUIContextMenuComponent.prototype,"contentRef",void 0);__decorate([core_1.ContentChildren(integralui_menuitem_1.IntegralUIMenuItem),__metadata("design:type",core_1.QueryList)],IntegralUIContextMenuComponent.prototype,"contentList",void 0);__decorate([core_1.Input(),__metadata("design:type",Array)],IntegralUIContextMenuComponent.prototype,"items",void 0);
__decorate([core_1.Input(),__metadata("design:type",Object)],IntegralUIContextMenuComponent.prototype,"position",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenuComponent.prototype,"itemClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenuComponent.prototype,"menuOpened",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenuComponent.prototype,"menuClosed",void 0);
IntegralUIContextMenuComponent=__decorate([core_1.Component({selector:"iui-contextmenu",template:'\n\t\t<div [ngClass]="getControlClass()" [ngStyle]="{ \'top\': position.y, \'left\': position.x, \'height\': blockElemHeight, \'opacity\': blockOpacity }" (blur)="onBlur($event)" (contextmenu)="onRightClick($event)" tabindex="999">\n\t\t\t<ul #content>\n\t\t\t\t\x3c!-- <iui-menuitem *ngFor="let item of items" [data]="item" [icon]="item.icon"  [text]="item.text" (itemMouseDown)="itemClicked($event)" [orientation]="vertical"></iui-menuitem> --\x3e\n\t\t\t\t<iui-menuitem *ngFor="let item of items" [data]="item" [enabled]="item.enabled" [icon]="item.icon"  [text]="item.text" [orientation]="\'vertical\'"></iui-menuitem>\n\t\t\t</ul>\n\t\t</div>\n\t',inputs:["controlStyle",
"data","state"],providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService],encapsulation:core_1.ViewEncapsulation.None}),__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,core_1.ElementRef,integralui_common_service_1.IntegralUICommonService,core_1.ComponentFactoryResolver,integralui_core_1.IntegralUIBaseService])],IntegralUIContextMenuComponent);exports.IntegralUIContextMenuComponent=IntegralUIContextMenuComponent;
var IntegralUIContextMenu=function(){function d(a,b,c){this.elemRef=a;this.viewContainer=b;this.cmpResolver=c;this.isMenuActive=!1;this.eventList=[];this.cmpRef=null;this.itemClick=new core_1.EventEmitter;this.menuClick=new core_1.EventEmitter;this.menuOpening=new core_1.EventEmitter;this.menuOpened=new core_1.EventEmitter;this.menuClosed=new core_1.EventEmitter}d.prototype.ngOnDestroy=function(){this.closeMenu()};d.prototype.closeMenu=function(a){this.cmpRef&&(this.eventList&&this.eventList.forEach(function(b){return b.unsubscribe()}),
this.cmpRef.destroy());a&&this.menuClosed.emit({event:a})};d.prototype.onContextMenu=function(a){a.preventDefault();var b=this,c=b.contextMenuRef?b.contextMenuRef:b.settings.appRef;if(c){b.closeMenu();b.menuOpening.emit(a);var d=b.cmpResolver.resolveComponentFactory(IntegralUIContextMenuComponent);d&&(b.cmpRef=c.createComponent(d),b.cmpRef&&(c=null,b.cmpRef._component?c=b.cmpRef._component:b.cmpRef._hostElement&&(c=b.cmpRef._hostElement.component),c&&(b.isMenuActive=!0,c.position={x:a.pageX+"px",
y:a.pageY+"px"},c.items=b.createMenuList(b.settings.items),c.open(a),b.eventList.push(c.itemClick.subscribe(function(a){b.itemClick.emit(a);b.menuClick.emit(a);b.closeMenu(a)})),b.eventList.push(c.menuOpened.subscribe(function(a){b.menuOpened.emit(a)})),b.eventList.push(c.menuClosed.subscribe(function(a){b.closeMenu(a)})))))}};d.prototype.createMenuList=function(a){var b=[];if(a)for(var c=0;c<a.length;c++)0!=a[c].visible&&b.push(a[c]);return b};return d}();
__decorate([core_1.Input("iuiContextMenu"),__metadata("design:type",Object)],IntegralUIContextMenu.prototype,"settings",void 0);__decorate([core_1.Input(),__metadata("design:type",Object)],IntegralUIContextMenu.prototype,"contextMenuRef",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenu.prototype,"itemClick",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenu.prototype,"menuClick",void 0);
__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenu.prototype,"menuOpening",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenu.prototype,"menuOpened",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],IntegralUIContextMenu.prototype,"menuClosed",void 0);
__decorate([core_1.HostListener("contextmenu",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],IntegralUIContextMenu.prototype,"onContextMenu",null);IntegralUIContextMenu=__decorate([core_1.Directive({selector:"[iuiContextMenu]"}),__metadata("design:paramtypes",[core_1.ElementRef,core_1.ViewContainerRef,core_1.ComponentFactoryResolver])],IntegralUIContextMenu);exports.IntegralUIContextMenu=IntegralUIContextMenu;